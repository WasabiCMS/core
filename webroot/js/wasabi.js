define("common/BaseViewFactory",["require","underscore"],function(e){var t=e("underscore"),i=function(e){this.eventBus=e,this.registry={factory:this}};return i.prototype=t.extend({},{register:function(e,t){return this.registry[e]=t,this.registry[e]},create:function(e,i){var s,o;return i=i||{},o=t.extend(i,this.registry,{eventBus:this.eventBus}),s=e,s.prototype.eventBus=this.eventBus,new s(o)}}),i}),define("wasabi",["require","jquery","underscore","backbone","./common/BaseViewFactory","bootstrap.dropdown"],function(e){var t=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("./common/BaseViewFactory");e("bootstrap.dropdown");var a=i.extend({},s.Events),n=new o(a),r=0,l="undefined";if(typeof window.WS!==l)return window.WS;var c={features:{},modules:{registered:[]},views:[],eventBus:a,viewFactory:n,boot:function(){function i(t){var i=t.name,o=t.require,a=t.options;e([o],function(e){s.modules[i]=e,s.modules[i].initialize(a)})}for(var s=this,o=0,a=this.modules.registered.length;a>o;o++)i(this.modules.registered[o]);t(window).on("resize",function(){clearTimeout(r),r=setTimeout(function(){c.eventBus.trigger("window.resize")},100)})},registerModule:function(e,t){this.modules.registered.push({name:e,require:e,options:t||{}})},get:function(e){return this.modules[e]?this.modules[e]:void console.debug('module "'+e+" is not registered.")},createView:function(e,t){return this.viewFactory.create(e,t||{})},createViews:function(e,t,s){var o=[];return e.length>0&&e.each(function(e,a){o.push(c.createView(t,i.extend({el:a},s||{})))}),o}};return window.WS=c,c}),define("core/views/Menu",["require","jquery","common/BaseView","wasabi","bootstrap.collapse"],function(e){{var t=e("jquery"),i=e("common/BaseView");e("wasabi")}e("bootstrap.collapse");var s={collapsedClass:"collapsed",openClass:"open",selectedClass:"popout"},o=function(e,i){var s=t(e.target);return s.is("li")?s:(i=i||"",s.closest("li"+i))};return i.extend({el:"#backend-menu > ul",events:{"click > li:has(ul) > a":"onMainItemClick"},globalEvents:{"window.resize":"collapseMenu"},isCollapsed:!1,options:{},initialize:function(e){this.options=t.extend({},s,e),this.$("> li").filter(".active").prev().addClass("prev-active"),this.collapseMenu()},collapseMenu:function(){var e=window.getComputedStyle(document.querySelector("#backend-menu"),"::before").getPropertyValue("content").replace(/'/g,"").replace(/"/g,"");this.isCollapsed="collapsed"===e,this.$el.toggleClass(this.options.collapsedClass,this.isCollapsed),this.isCollapsed||this.$el.find("."+this.options.selectedClass).removeClass(this.options.selectedClass)},onMainItemClick:function(e){var i=o(e);0!==i.find(".sub-nav").length&&(e.preventDefault(),e.stopPropagation(),this.$("."+this.options.selectedClass).removeClass(this.options.selectedClass),this.isCollapsed?i.hasClass(this.options.selectedClass)?(i.removeClass(this.options.selectedClass),t(document).off("click",_.bind(this.hideSubnav,this))):(i.addClass(this.options.selectedClass),t(document).on("click",_.bind(this.hideSubnav,this))):i.hasClass(this.options.openClass)?(i.removeClass(this.options.openClass),i.find(".sub-nav").collapse("hide")):(i.addClass(this.options.openClass),i.find(".sub-nav").collapse("show")))},hideSubnav:function(e){var t=o(e);0===t.parents("."+this.options.selectedClass).length&&this.$("."+this.options.selectedClass).removeClass(this.options.selectedClass)}})}),define("core/views/NavigationToggle",["require","jquery","common/BaseView"],function(e){var t=e("jquery"),i=e("common/BaseView"),s=t("body"),o={forceOpenClass:"backend-nav--is-visible"};return i.extend({el:"#page-header .nav-toggle",events:{click:"toggleNav"},options:{},initialize:function(e){this.options=t.extend({},o,e)},toggleNav:function(){s.hasClass(this.options.forceOpenClass)?s.removeClass(this.options.forceOpenClass):s.addClass(this.options.forceOpenClass)}})}),define("core/views/LangSwitch",["require","underscore","common/BaseView"],function(e){var t=e("underscore"),i=e("common/BaseView");return i.extend({el:".lang-switch",globalEvents:{"wasabi-core--languages-sort":"updateLanguageLinkPositions"},updateLanguageLinkPositions:function(e,i){var s=i.frontendLanguages,o=[],a=this.$("li");t.each(s,function(e){o.push(a.filter('[data-language-id="'+e.id+'"]'))}),this.$el.html(o)}})}),define("core/views/Pagination",["require","jquery","common/BaseView","purl"],function(e){var t=e("jquery"),i=e("common/BaseView"),s=e("purl");return i.extend({el:".pagination",events:{"change .limit":"onChangeLimit"},onChangeLimit:function(e){var i=t(e.target),o=i.val(),a=i.attr("data-url"),n=s(window.location),r=i.attr("name").split("data[").join("").split("]").join(""),l=n.data.param.query;l[r]=o.toString();var c="",d=[];for(var u in l)l.hasOwnProperty(u)&&d.push(u+"="+l[u]);c=d.join("&"),""!==c&&(c="?"+c),window.location=a+c}})}),define("common/ModalView",["require","jquery","underscore","common/BaseView","wasabi"],function(e){var t=e("jquery"),i=e("underscore"),s=e("common/BaseView"),o=e("wasabi"),a=t("body"),n=t(document),r=t(window),l={width:400,offsetTop:200,opacity:.35,padding:20,cssClasses:{backdrop:"modal-backdrop",scrollable:"modal-scrollable",container:"modal-container",modalHeader:"modal-header",modalBody:"modal-body",modalFooter:"modal-footer",confirmFooter:"modal-confirm"},confirmYes:"Yes",confirmNo:"No",closeOnScrollable:!0,closeOnSubmit:!0};return s.extend({template:"",$backdrop:null,$container:null,$closeButtons:null,$modal:null,$notify:null,$scrollable:null,$submitButtons:null,events:{click:"openModal"},globalEvents:{"window.resize":"onResize"},modalName:null,isConfirmModal:!1,isOpened:!1,method:null,modalSuccessEvent:null,options:{},initialize:function(e){this.options=t.extend({},l,e),this.template=i.template(t("#wasabi-core-modal").html())},initModalOptions:function(){if(this.method=this.$el.attr("data-modal-method")||"post",this.isAjax="1"===this.$el.attr("data-modal-ajax")||"true"===this.$el.attr("data-modal-ajax"),this.action=this.$el.attr("data-modal-action")||this.$el.attr("href")||!1,this.isAjax){var e=this.$el.attr("data-modal-notify");this.$notify=void 0!==e?t(e):n,this.modalSuccessEvent=this.$el.attr("data-modal-event")||"modal:success"}var i=parseInt(this.$el.attr("data-modal-width"));i&&(this.options.width=i),"undefined"!=typeof this.$el.attr("data-modal-close-on-scrollable")&&(this.options.closeOnScrollable=parseInt(this.$el.attr("data-modal-close-on-scrollable"))),"undefined"!=typeof this.$el.attr("data-modal-close-on-submit")&&(this.options.closeOnSubmit=parseInt(this.$el.attr("data-modal-close-on-submit"))),this.options.forceCloseModalLink=parseInt(this.$el.attr("data-force-close-modal-link"))},createTemplateOptions:function(){var e,i,s={};return s.modalHeader=this.$el.attr("data-modal-header")||this.options.modalHeader,s.hasHeader=void 0!==s.modalHeader,s.modalBody=this.$el.attr("data-modal-body")||this.options.modalBody,s.hasBody=void 0!==s.modalBody,s.hasBody||(i=t(this.$el.attr("data-modal-target")),e=i.length>0,e&&(s.modalBody=i.html(),s.hasBody=!0)),s.isConfirmModal="confirm"===this.$el.attr("data-toggle"),s.isConfirmModal?s.hasFooter=!0:(s.modalFooter=this.$el.attr("data-modal-footer"),s.hasFooter=void 0!==s.modalFooter),s.action=this.action,s.method=this.method,s.cssClasses=this.options.cssClasses,s.confirmYes=this.options.confirmYes,s.confirmNo=this.options.confirmNo,s.forceCloseModalLink=this.options.forceCloseModalLink,s.hasCloseLink=!s.isConfirmModal||s.forceCloseModalLink,s},initModalElements:function(){this.$modal=t(this.template(this.createTemplateOptions())),this.$backdrop=this.$modal.find("."+this.options.cssClasses.backdrop),this.$backdrop.css({opacity:this.options.opacity}),this.$scrollable=this.$modal.find("."+this.options.cssClasses.scrollable),this.$container=this.$modal.find("."+this.options.cssClasses.container),this.$container.css({width:this.options.width,position:"fixed",left:-99999,top:this.options.offsetTop,opacity:0,zIndex:1e4}),this.$closeButtons=this.$modal.find('[data-dismiss="modal"]'),this.$submitButtons=this.$modal.find('button[type="submit"]')},updatePosition:function(){var e=this.$container.outerHeight(),t=this.$container.offset().top-this.$scrollable.offset().top,i=this.$scrollable.height(),s=i-e-t<this.options.offsetTop;r.height()<n.height()?a.addClass("page-overflow").addClass("fix-scroll-"+this.options.scrollbarWidth):a.removeClass("page-overflow").removeClass("fix-scroll-"+this.options.scrollbarWidth),this.$container.css(s?e+2*this.options.padding<=i?{top:"50%",marginTop:-e/2}:{top:this.options.padding,marginTop:0}:{top:this.options.offsetTop,marginTop:0}),this.$container.css({position:"absolute",marginLeft:-this.options.width/2,left:"50%"})},resetDOM:function(){a.removeClass("modal-open").removeClass("page-overflow"),this.$modal=null,this.$container=null,this.$scrollable=null,this.$backdrop=null,this.$submitButtons=[]},onResize:function(){this.isOpened&&this.updatePosition()},submit:function(e){var i=t(e.target),s=this;if(void 0===i.attr("disabled"))if(this.isAjax){e.preventDefault(),i.prop("disabled",!0),this.$notify.trigger("modal:beforeAjax");var a,n=this.$modal.find("form");n.length>0&&(a=this.$modal.find("form").serialize()),t.ajax({type:this.method,url:this.action,cache:!1,data:a,success:function(e){s.closeModal(),s.$notify.trigger(s.modalSuccessEvent,e)}})}else this.modalName&&o.eventBus.trigger("modal-submitted-"+this.modalName,this,e),this.options.closeOnSubmit&&this.closeModal()},openModal:function(e){if(e&&e.preventDefault(),!this.isOpened){if(this.isOpened=!0,this.initModalOptions(),this.initModalElements(),a.addClass("modal-open"),this.$modal.appendTo(a),this.updatePosition(),this.$container.hide().css("opacity",1).fadeIn(),this.$closeButtons.length>1)for(var s=0,n=this.$closeButtons.length;n>s;s++)t(this.$closeButtons[s]).on("click",i.bind(this.closeModal,this));else this.$closeButtons.on("click",i.bind(this.closeModal,this));this.options.closeOnScrollable&&this.$scrollable.on("click",i.bind(this.closeModal,this)),this.$submitButtons.length&&this.$submitButtons.on("click",i.bind(this.submit,this)),this.modalName=this.$el.attr("data-modal-name"),this.modalName&&(this.$modal.attr("data-modal-name",this.modalName),o.eventBus.trigger("modal-opened-"+this.modalName,this))}},closeModal:function(e){if("object"==typeof e){if(e.target!==e.currentTarget&&t(e.target).parent()[0]!==e.currentTarget)return;e.preventDefault()}if(this.$closeButtons.length>1)for(var s=0,o=this.$closeButtons.length;o>s;s++)t(this.$closeButtons[s]).off("click",i.bind(this.closeModal,this));else this.$closeButtons.off("click",i.bind(this.closeModal,this));this.options.closeOnScrollable&&this.$scrollable.off("click",i.bind(this.closeModal,this)),this.$submitButtons.length&&this.$submitButtons.off("click",i.bind(this.submit,this)),this.unblockThis(),t.when.apply(null,[this.$container.fadeOut(200),this.$backdrop.fadeOut(200)]).then(t.proxy(function(){this.$modal&&this.$modal.remove(),this.resetDOM(),this.isOpened=!1,"function"==typeof e&&e.call()},this))}})}),define("common/TabView",["require","jquery","common/BaseView"],function(e){var t=e("jquery"),i=e("common/BaseView");return i.extend({events:{"click li":"onClick","click a":"onClick"},initialize:function(){this.tabifyId=this.$el.attr("data-tabify-id"),this.$listItems=this.$("> li"),this.$tabs=t("div[data-tabify-tab]").filter('[data-tabify-id="'+this.tabifyId+'"]')},onClick:function(e){e.preventDefault();var i=t(e.target);if(i.is("a")&&(i=i.parent()),!i.is("li"))return!1;var s=i.attr("data-tabify-target"),o=i.attr("data-tabify-disabled");return"undefined"!=typeof o&&"1"===o?!1:(this.$listItems.removeClass("active"),this.$tabs.removeClass("active").hide(),this.$tabs.filter('[data-tabify-tab="'+s+'"]').addClass("active").show(),void i.addClass("active"))}})}),define("core/views/LanguagesTable",["require","jquery","common/BaseView","wasabi","jquery.tSortable"],function(e){var t=e("jquery"),i=e("common/BaseView"),s=e("wasabi");return e("jquery.tSortable"),i.extend({events:{"tSortable-change":"onSort"},initialize:function(){this.$form=this.$el.closest("form"),this.$el.tSortable({handle:"a.action-sort",placeholder:"sortable-placeholder",opacity:.8})},onSort:function(e){var i=t(e.target);i.find("tbody > tr").each(function(e){t(this).find("input.position").first().val(e)}),t.ajax({url:this.$form.attr("action"),data:this.$form.serialize(),type:"post",success:function(t){s.eventBus.trigger("wasabi-core--languages-sort",e,t)}})}})}),define("core/sections/LanguagesIndex",["require","common/BaseView","wasabi","../views/LanguagesTable"],function(e){var t=e("common/BaseView"),i=e("wasabi"),s=e("../views/LanguagesTable");return t.extend({el:".wasabi-core--languages-index",initialize:function(){i.createView(s,{el:this.$("table.languages")})}})}),define("core/sections/GroupPermissionsIndex",["require","jquery","common/BaseView","jquery.color"],function(e){var t=e("jquery"),i=e("common/BaseView");return e("jquery.color"),i.extend({el:".wasabi-core--grouppermissions-index",events:{"click .single-submit":"onSingleSubmit"},onSingleSubmit:function(e){e.preventDefault();var i=t(e.target),s=t('<div class="spinner"/>');i.hide().blur().parent().append(s),t.ajax({type:"post",url:this.$(".permissions-update-form").attr("action"),data:i.parent().parent().find("input").serialize(),dataType:"json",cache:!1,success:function(){var e=i.parent().parent(),o=i.parent().css("backgroundColor");s.remove(),i.show(),e.find("td:not(.controller)").stop().css({backgroundColor:"#fff7d9"}).animate({backgroundColor:o},1e3,function(){t(this).css({backgroundColor:""})})}})}})}),define("core/views/MenuItemsList",["require","underscore","jquery","common/BaseView","jquery.nSortable"],function(e){var t=e("underscore"),i=e("jquery"),s=e("common/BaseView");return e("jquery.nSortable"),s.extend({events:{"nSortable-change":"onSort"},section:{},menuItemsReorderUrl:!1,initialize:function(e){this.section=e.section,this.menuItemsReorderUrl=this.$el.attr("data-reorder-url"),this.$el.nSortable({handle:"a.move",tabWidth:20,placeholder:"sortable-placeholder",dataAttribute:"data-menu-item-id",maxDepth:parseInt(this.$el.attr("data-maximum-nesting-level")),serializeKey:"",serializeWrapKeys:!1,serializeParentIdNullable:!0,leftKey:"lft",rightKey:"rght",animateTarget:!1})},onSort:function(e,s){this.blockThis({backgroundColor:"#fff",deltaHeight:-1});var o=s.toArray();for(var a in o)if(o.hasOwnProperty(a)){var n=o[a],r=this.$el.find('li[data-menu-item-id="'+n.id+'"]').first().find(".wicon-add").first().parent();n.depth>2?r.addClass("hidden"):r.removeClass("hidden")}i.ajax({type:"post",dataType:"json",url:this.menuItemsReorderUrl,data:s.serialize(),cache:!1,success:t.bind(this.unblockThis,this)})}})}),define("core/sections/MenusEdit",["require","common/BaseView","wasabi","../views/MenuItemsList"],function(e){var t=e("common/BaseView"),i=e("wasabi"),s=e("../views/MenuItemsList");return t.extend({el:".wasabi-core--menus-edit",initialize:function(){i.createView(s,{el:this.$(".menu-items"),section:this})}})}),define("wasabi.core",["require","jquery","underscore","core/views/Menu","core/views/NavigationToggle","core/views/LangSwitch","core/views/Pagination","common/ModalView","common/TabView","wasabi","jquery.livequery","core/sections/LanguagesIndex","core/sections/GroupPermissionsIndex","core/sections/MenusEdit"],function(e){function t(){h.ajaxSetup({dataType:"json"}),h(C).ajaxSuccess(i).ajaxError(s)}function i(e,t){if(200==t.status&&"OK"==t.statusText){var i=h.parseJSON(t.responseText)||{};"undefined"!=typeof i.status&&("undefined"!=typeof i.flash&&a(i.flash),"undefined"!=typeof i.redirect&&($.location=i.redirect))}}function s(e,t){var i;401==t.status&&(i=h.parseJSON(t.responseText)||{},"undefined"!=typeof i.name&&(confirm(i.name),$.location.reload())),500==t.status&&(i=h.parseJSON(t.responseText)||{},"undefined"!=typeof i.name&&a({before:"div.title-pad","class":"error",message:i.name}))}function o(){function e(){var e=h("<div/>").css({width:"100px",height:"100px",overflow:"scroll",position:"absolute",top:"-9999px"}),t=h("body");e.prependTo(t);var i=0;return setTimeout(function(){i=e[0].offsetWidth-e[0].clientWidth},0),e.remove(),i}y.features.scrollbarWidth=e()}function a(e){var t=e.before||!1,i=e.after||!1,s=e.message,o=e["class"]?"flash-"+e["class"]:"flash-success",a=!1,n=h("<div/>").addClass(o).html(s);t?(a=h(t),a.prev("."+o).remove(),n.insertBefore(a)):i&&(a=h(i),a.next("."+o).remove(),n.insertAfter(a))}function n(){y.views.menu=y.createView(f),y.views.navigationToggle=y.createView(p),y.views.langSwitch=y.createView(v),y.views.paginations=y.createViews(h(".pagination"),b)}function r(){h("select").livequery(function(){h(this).toggleClass("empty",""===h(this).val()),h(this).change(function(){h(this).toggleClass("empty",""===h(this).val())})})}function l(){var e=this;y.views.modals=[],h('[data-toggle="modal"], [data-toggle="confirm"]').livequery(function(){y.views.modals.push(y.createView(g,{el:h(this),scrollbarWidth:y.features.scrollbarWidth,confirmYes:e.options.translations.confirmYes,confirmNo:e.options.translations.confirmNo}))})}function c(){h(".tabs[data-tabify-id]").livequery(function(){y.views.push(y.createView(w,{el:h(this)}))})}function d(){this.$body.hasClass("wasabi-core--languages-index")&&y.createView(e("core/sections/LanguagesIndex")),this.$body.hasClass("wasabi-core--grouppermissions-index")&&y.createView(e("core/sections/GroupPermissionsIndex")),this.$body.hasClass("wasabi-core--menus-edit")&&y.createView(e("core/sections/MenusEdit"))}function u(){clearTimeout(this.heartBeatTimeout),this.heartBeatTimeout=setTimeout(m.bind(function(){h.ajax({url:this.options.heartbeatEndpoint,method:"post",type:"json"}),u.call(this)},this),this.options.heartbeat),this.heartBeatTimeout=setTimeout(function(){},this.options.heartbeat)}var h=e("jquery"),m=e("underscore"),f=e("core/views/Menu"),p=e("core/views/NavigationToggle"),v=e("core/views/LangSwitch"),b=e("core/views/Pagination"),g=e("common/ModalView"),w=e("common/TabView"),y=e("wasabi");e("jquery.livequery");var $=window,C=document;return{options:{},w:null,d:null,$html:null,$body:null,views:[],collections:[],models:[],heartBeatTimeout:0,resizeTimeout:0,components:{},initialize:function(e){this.options=e||{},this.w=$,this.d=C,this.$html=h("html"),this.$body=h("body"),t.call(this),o.call(this),n.call(this),r.call(this),l.call(this),c.call(this),d.call(this),u.call(this)}}});